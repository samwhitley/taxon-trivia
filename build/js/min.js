var APP=APP||{};APP.taxa=function(a,b){function c(){l=0,j.length=0;for(var a=0;k>a;a++)j.push({})}function d(c){b.ajax({url:"http://eol.org/api/pages/1.0/"+c.page+".json",cache:!1,data:{key:h,images:50,text:0,details:!0},dataType:"jsonp",error:function(){alert("Could not connect to the Encyclopedia of Life API. Refresh your browser window or try again later.")},success:function(d){var e,f=void 0,g="";if(d.hasOwnProperty("dataObjects")&&d.dataObjects.length>0){for(e=d.dataObjects.length;!f||"http://purl.org/dc/dcmitype/StillImage"!==d.dataObjects[f].dataType;)f=Math.floor(Math.random()*e);g=d.scientificName.split(" ")[0],c.picURL=d.dataObjects[f].eolMediaURL,c.scientificName=g,c.correct===!0&&(m.picURL=c.picURL,m.scientificName=g),l++,l===k&&b(a).trigger("subTaxaImagesLoaded")}}})}var e={},f={primary:void 0,secondary:[]},g=[{name:"Mammalia",primary:1642,secondary:[7662,7631,42410182,7678,1686,8677,1665,8711]},{name:"Squamata",primary:1704,secondary:[1733,2819161,2819271,1708,40084768,4518884,8109,2816351,2815989]},{name:"Aves",primary:695,secondary:[8662,8024,7589,2917972,2922902,2918020,2921382,2922049,2869903,7976,1590,696,1596]}],h="5ac0ff1169dc81058cec2b7bd9f47fe4d68b4788",i={name:"",desc:""},j=[],k=3,l=0,m={picURL:"",scientificName:""};return e.setTaxonCategory=function(a){var b=g[a];f.primary=b.primary,f.secondary=b.secondary},e.checkAnswer=function(c){b(a).trigger(m.picURL===c?"correctGuess":"wrongGuess")},e.setSubTaxa=function(){var a=f.secondary.slice(0);c(),j[Math.floor(Math.random()*j.length)].correct=!0;for(var b=0;b<j.length;b++)j[b].page=a.splice(Math.floor(Math.random()*a.length),1)[0],d(j[b])},e.setMainTaxon=function(){b.ajax({url:"http://eol.org/api/pages/1.0/"+f.primary+".json",cache:!1,data:{key:h,text:1,images:0,videos:0,sounds:0,maps:0,details:!0},dataType:"jsonp",error:function(){alert("Could not connect to the Encyclopedia of Life API. Refresh your browser window or try again later.")},success:function(c){i.name=c.scientificName.split(" ")[0];for(var d=0;d<c.dataObjects.length;d++)"http://purl.org/dc/dcmitype/Text"===c.dataObjects[d].dataType&&(i.desc=c.dataObjects[d].description);b(a).trigger("mainTaxonLoaded")}})},e.getCategoryName=function(a){return g[a].name},e.getChoicesCount=function(){return k},e.getSubTaxonInfo=function(a){return j[a]},e.getMainTaxonInfo=function(){return i},e.getAnswerName=function(){return m.scientificName},e}(window,jQuery);var APP=APP||{};APP.view=function(a){var b={},c=a(".gameStatus"),d=a(".gameStatus .wrapper"),e=(a(".choiceArea"),a(".detailContent")),f=a(".choice img"),g=a(".imgWrap"),h=a(".ajaxOverlay"),i=a(".choice button"),j=a(".pageName");return b.prepareInfo=function(b){i.each(function(){a(this).slideToggle(600)}),h.each(function(){a(this).velocity("stop").velocity({opacity:1},{duration:600,display:"block"})}),c.slideToggle(600,function(){c.removeClass("activeButton"),"function"==typeof b&&b()})},b.prepareChoices=function(a,b,c){j.text(a),e.html("").append(b),"function"==typeof c&&c()},b.connectReplayEvent=function(a){c.one("click",function(){b.prepareInfo(a)})},b.printImage=function(b,c,d){var e=f[c],j=g[c],k=h[c],l=i[c];a(j).css("background-image","url('"+b+"')"),a(e).attr("src",b).load(function(){a(k).velocity("stop").velocity({opacity:0},{duration:1e3,display:"none"})}),a(l).off("click"),a(l).on("click",function(){var a=b;"function"==typeof d&&d(a)})},b.printChallengeText=function(a){d.html("").append("Pick a member of <strong class='answer'>"+a+".</strong>"),c.slideToggle("slow")},b.printChoiceButtonArea=function(){i.each(function(){a(this).slideToggle("slow")})},b.printActiveButton=function(b){var c=a(i[b]);c.text("Choice"+(b+1)).addClass("activeButton")},b.printAnswer=function(b,c){var d=a(i[b]);d.text(c).off("click").removeClass("activeButton")},b.printPlayAgainMessage=function(a){c.addClass("activeButton"),d.html(a)},b.activatePlayButton=function(a,e){c.hasClass("activeButton")||(c.one("click",function(){b.prepareInfo(e)}),c.addClass("activeButton")),d.html("<p>You've chosen <strong>"+a+".</strong> Click here to start!</p>")},b.connectTaxonChoiceEvents=function(c,d,e){for(var f=0,g=i.length;g>f;f++)!function(f){var g=a(i[f]),h=d(f);g.on("click",function(){c(f),b.activatePlayButton(h,e)})}(f)},b}(jQuery,APP.taxa,window);var APP=APP||{};APP.controller=function(a,b,c,d){function e(){b(a).on("mainTaxonLoaded",j).on("subTaxaImagesLoaded",k).on("correctGuess",f).on("wrongGuess",g),n.click(function(){p?(o.removeClass("showDetails"),p=!1):(o.addClass("showDetails"),p=!0)})}function f(){var a="Good job! The animal you chose belongs to <strong>"+c.getAnswerName()+".</strong> Click here to play again.";h(a)}function g(){var a="Sorry, the animal you chose is not a member of <strong>"+c.getAnswerName()+".</strong> Click here to play again.";h(a)}function h(a){d.printPlayAgainMessage(a),i(),d.connectReplayEvent(c.setSubTaxa)}function i(){for(var a=0;m>a;a++)d.printAnswer(a,c.getSubTaxonInfo(a).scientificName)}function j(){var a=c.getMainTaxonInfo();d.prepareChoices(a.name,a.desc,c.setSubTaxa)}function k(){var a,b=c.getAnswerName();m=c.getChoicesCount();for(var e=0;m>e;e++)a=c.getSubTaxonInfo(e),d.printActiveButton(e),d.printImage(a.picURL,e,c.checkAnswer);d.printChallengeText(b),d.printChoiceButtonArea()}function l(){e(),d.connectTaxonChoiceEvents(c.setTaxonCategory,c.getCategoryName,c.setMainTaxon)}var m,n=(b("body"),b(".info")),o=b(".details"),p=!1;return{init:l}}(window,jQuery,APP.taxa,APP.view),APP.controller.init();